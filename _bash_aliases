#!/bin/bash

scriptDir="$( dirname $( readlink -f ${BASH_SOURCE[0]} ) )/scripts"

# --- Standard commands, but running in containers -----------------------------

node() {
    docker run -ti --rm --user node -v $HOME:/home/node --workdir $( echo "$PWD" | sed "s|/home/$USER|/home/node|" ) --net host guzo/npm node $*
}
export -f node

npm() {
    if [ -t 1 ] ; then
        docker run -ti --rm --user node -v $HOME:/home/node --workdir $( echo "$PWD" | sed "s|/home/$USER|/home/node|" ) --net host guzo/npm npm $*
    else
        docker run -i --rm --user node -v $HOME:/home/node --workdir $( echo "$PWD" | sed "s|/home/$USER|/home/node|" ) --net host guzo/npm npm $*
    fi
}
export -f npm

hugo() {
    if [ -t 1 ] ; then
        docker run -ti --rm -v $PWD:/home/appuser --workdir /home/appuser -p 8888:8888 guzo/hugo hugo $*
    else
        docker run -i --rm -v $PWD:/home/appuser --workdir /home/appuser -p 8888:8888 guzo/hugo hugo $*
    fi
}
export -f hugo

# --- Custom stuff -------------------------------------------------------------

alias docker-rmi='docker rmi $(docker images --filter "dangling=true" -q --no-trunc)'
alias docker-rm='docker rm $(docker ps -a --filter status=exited -q --no-trunc)'
alias mgit="${scriptDir}/multigit.sh"

# --- Functions for slightly more complicated commands -------------------------

httpd() {
    if [[ "$1" == "" ]] ; then
        echo "Syntax: httpd <PORT>"
    else
        docker run -it --rm --name apache-httpd -p ${1}:80 -v "$PWD":/usr/local/apache2/htdocs/ httpd:alpine
    fi
}
